# 네트워크의 전체 흐름 살펴보기

### 

### 랜 카드에서의 데이터 전달과 처리

**계층별 역할**

**네트워크의 구성: OSI 응용계층 ~ 물리계층**

* *참고*_프로토콜: 물리계층에도 RS-232, X_25, X_21 등의 프로토콜이 있긴 하다
* 응용계층(+표현, 세션 계층)
  * 다양한 애플리케이션이 동작하는 계층
  * 웹서버 - HTTP, HTML
  * DNS 서버 - 도메인, IP
    * 한개의 도메인에 여러개의 ip 가능
* 전송계층
  * 신뢰가능한 데이터의 순차적 전달, 오류 점검, 데이터의 목적지인 애플리케이션 식별
* 네트워크 계층
  * 다른 네트워크간 통신을 위한 경로설정을 위해 라우터를 통한 라우팅
  * 패킷 전송
* 데이터링크계층
  * 네트워크 기기간 데이터 전송 및 물리주소 결정
  * 이더넷, CSMA/CD 방식
  * 이더넷 헤더, 이더넷 프레임, 트레일러
  * MAC 주소(출발지/목적지)
  * 스위치
  * 전이중통신, 반이중통신
    * duplex mismatch: 전이중통신에서도 충돌이 일어날 수는 있다
* 물리계층 (하위 계층)
  * 데이터를 전기 신호로 변환



**네트워크의 구성**

* 스위치만 있는 네트워크에서는 모든 컴퓨터와 스위치가 동일한 네트워크에 속함
* 네트워크를 분리하는 것은 라우터 (물리적인 구분)
* cf) VLAN(가상랜): 논리적 구분
  * 편의를 위해 가상으로 구분하는 것. 스위치를 활용함. 하나의 네트워크에 존재해도 물리적 거리가 가까워도 하나의 네트워크를 구성하고 싶은 경우 가능... 찾아보자!



**컴퓨터의 데이터가 전기 신호로 변환되는 과정**

* 컴퓨터의 웹 브라우저에 URL을 입력할 때부터 웹 서버에 도착할 때까지 이루어지는 OSI 모델의 캡슐화와 역캡슐화 과정
* 3-way handshake는 이미 완료되어 연결은 확립되어 있다고 가정
* 웹브라우저에 URL 입력 후 ENTER --> 응용 ㄱㅖ층에서의 캡슐화 시작
* 응용계층 : html 데이터를 보내달라는 HTTP 메세지를 보냄
* 전송계층: 이 데이터가 전달되고 TCP 헤더가 붙음
* 네트워크 계층에 연결된 세그먼트에 IP 헤더를 붙여 IP 패킷이 됨
* 데이터링크 계층에서 이더넷 헤더가 붙어 이더넷 프레임이 됨
* 물리 계층에서 데이터가 랜 카드를 통해 전기신호로 변환되어 네트워크로 전송



### 스위치와 라우터에서의 데이터 전달과 처리

* 스위치에서의 데이터 전달은 물리계층 -> 데이터링크 계층 -> 물리계층 순으로 이루어짐
* 물리 계층에서 컴퓨터에서 들어온 데이터가 전기 신호로 변환되어 데이터 링크 계층으로 전달
* 스위치 A는 데이터 링크 계층에서 데이터를 전기 신호로 변환해 라우터 A로 전송
* 스위치 A
* 라우터 A
  * 라우터 A에서의 역캡슐화와 캡슐화
  * 전기 신호 형태의 데이터가 라우터 A에서 라우터 B로 전달
* 라우터 B
  * 라우터 B에서의 역캡슐화와 캡슐화
  * 전기 신호의 형태의 데이터가 라우터 B에서 스위치 B로 전달
* 스위치 B



### 웹 서버에서의 데이터 전달과 처리

**웹 서버에서 이루어지는 OSI 모델의 역캡슐화**

* 물리계층에서 전기 신호로 변환된 데이터를 스위치 B로부터 전달받음
* 웹서버는 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교
  * 주소 같으면 이더넷 헤더와 트레일러를 분리하고 네트워크 계층에 전달
* 네트워크 계층에서는 목적지 IP 주소와 웹 서버의 IP 주소가 같은지 확인
  * 주소 같으면 IP 헤더 분리하고 전송 계층에 전달
* 전송 계층에서 목적지 포트 번호를 확인해 어떤 애플리케이션으로 전달해야 되는지 판단 후 TCP 헤더를 분리해 응용 계층에 전달
  * 웹 서버 응용 계층에 도착





> 라우팅

* 패킷을 목적지 컴퓨터까지 보낼 때 최적의 경로를 선택하여 전송하는 것

* 정적 라우팅
  * 관리자가 미리 라우팅 테이블에 경로를 수동으로 추가하는 방법
  * 주 용도는 목적지까지의 경로를 고정하거나 목적지까지의 경로가 하나로 한정되는 경우
  * 관리자가 모든 목적지 정보를 라우터에 알려주어야 하기 때문에 소규모 네트워크에서 사용
  * 장점: 라우팅 정보가 교환되지 않아 대역폭에 대한 부담감 적음, 라우팅 정보가 네트워크로 전달되지 않아 보안 유지에 유리함
  * 단점: 동적으로 반영되지 않아 어떤 경로에 장애가 발생해도 다른 경로로 우회할 수 없음. 관리자가 설정 하나하나를 변경해야 함
* 동적 라우팅
  * 네트워크 변경 자동 감지
  * 장애 발생시 라우터끼리 정보 교환하여 최적 경로로 전환
  * 대규모 네트워크에서 사용
    * 정적 라우팅 지원하지 않음