# 전송 계층 : 신뢰할 수 있는 데이터 전송하기

면접 시 네트워크 질문 나오면 단골로 나오는 파트 :star::star2:

> 전송 계층의 역할

* 전송 계층은 목적지에 신뢰할 수 있는 데이터를 전달하는 역할
  * 오류 발생 시 데이터를 재전송 하도록 요청
  * 전송된 데이터의 목적지가 어떤 어플리케이션인지 식별함
* 전송 계층의특징
  * 신뢰성/정확성
    * 데이터를 목적지에 문제없이 전달하는 것
    * 연결형 통신
      * 상대편과 확인해 가면서 통신하는 방신
      * TCP
  * 효율성
    * 데이터를 빠르고 효율적으로 전달하는 것
    * 비연결형 통신
      * 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식
      * **동영상 스트리밍**의 경우 빠른 전송이 필요하므로 비연결형 통신을 사용
      * UDP
      * 최근에는 TCP의 장점을 흡수한 UDP를 만들려고 하는 추세.. 지금은 TCP를 많이 쓰고 있긴 함

> TCP의 구조

* TCP는 신뢰성과 정확성을 우선으로 하는 연결형 통신 프로토콜

* TCP로 전송 시 붙이는 헤더를 TCP 헤더라고 하고, 이 헤더가 붙은 데이터를 세그먼트라고 함

* 데이터를 전송하기 위해 연결(connection)이라는 가상의 독점 통신로를 확보해야 함

  * TCP 헤더에서 연결의 제어 정보가 107 - 112 번째 비트 자리의 코드 비트에 기록됨

  * 코드 비트는 각 비트별로 역할이 존재

    * 초기값은 0이고 비트가 활성화되면 1이 됨
    * 연결을 확립하려면 SYN(연결 요청)N 과 ACK(확인 응답)가 필요

  * 신뢰할 수 있는 연결을 하려면 데이터를 전송하기 전에 패킷을 교환함

    1. 컴퓨터 1이 컴퓨터 2에게 연결 확립 허가를 받기 위한 요청(SYN)을 보냄
    2. 컴퓨터2는 컴퓨터1이 보낸 요청을 받은 후, 허가한다는 응답을 회신하기 위
    3. ~~

    * 이처럼 데이터를 보내기 전에 연결 확립을 위해 패킷 요청을 세 번 교환 하는 것을 **3-way 핸드셰이크** 라고 함 :star::star2::star::star2:

  * 데이터를 전송한 후에는 연결을 끊기 위한 요청을 교환해야 하는데, 이를 **4-way 핸드셰이크**라고 함

    * FIN(연결 종료)와 ACK 사용
    * Q) 왜 얘도 같이 보내면 안되나? 굳이 따로 보내는 이유가 뭘까??? 아직 답을 찾지는 못함...
      * 아직 남은 데이터가 잇을 수도 있으니까 나머지 데이터를 보낸 후에 ,, 보내야 하기 때문이다!?



> 일련번호와 확인 응답 번호의 구조

* TCP는 데이터 분할해서 보내는데, 일련번호는 송신 측에서 수신 측에 '이 데이터가 몇 번째 데이터인지' 알려주는 역할'
* 확인 응답 번호는 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할
* 재전송 제어
* 위의 과정은 세그먼트를 하나 보낼 때마다 확인 응답을 한 번 반환해야 하므로 효율이 낮음 (문제점)
* 매번 확인 응답을 기다리는 대신 세그먼트를 연속해서 보내고 난 다음에 확인 응답을 반환하면 효율이 높아짐
  * 수신측에는 받은 세그먼트를 연속해서 보내도 수신 측은 대응할 수 있고, 확인 응답의 효율도 높아짐
  * 그러나 수신 측에 대량으로 데이터가 전송되면 보관하지 못하고 넘치게 되는데, 이를 오버플로우라고 함 (수신측의 버퍼 사이즈보다 큰 데이터를 보내는 경우..)
    * 오버플로우가 발생하지 않도록 버퍼의 한계 크기를 알고 있어야 함
      * 이 값이 TCP 헤더의 윈도우 크기 값
      * 얼마나 많은 용량의 데이터를 저장해 둘 수 있는지를 나타냄
      * 윈도우 크기 초기값은 3-way 핸드셰이크를 할 때 판단



> 포트 번호의 구조

* 데이터를 올바른 어플리케이션에 전송할 수 있도록 TCP 헤더의 출발지 포트 번호와 목적지 포트 번호가 필요함
* 포트 번호를 통해 어플리케이션 구분 가능
* 포드 번호는 0 ~ 65535번 사용 가능
  * well-known ports
    * 0 ~ 1023번 포트
    * 주요 프로토콜이 사용하도록 예약
  * random ports
    * 1025번 이상
    * 클라이언트 측의 송신 포트로 사용
* 웹 프라우저에 접속하면, 임의의 포트가 자동으로 할당
  * 서버 측에서는 포트 번호를 정해 두어야 하지만, 클라이언트 측은 정하지 않아도 됨



> UDP의 구조

* UDP는 비연결형 통신이라서 데이터를 전송할 때, TCP처럼 시간이 걸리는 확인 작업을 일일히 하지 않음
* UDP 헤더가 붙은 데이터를 UDP 데이터그램이라고 함
  * UDP 헤더는 TCP 헤더에 비해 간결함
* 효율성과 빠른 속도가 중요해서 상대방을 확인하지 않고 연속해서 데이터를 보냄
* 브로드개스트
  * UDP를 이용하여 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보냄
  * TCP는 3-way 핸드셰이크와 같이 데이터를 전송할 때도 확인 응답을 하나씩 보내야 하기 때문에 브로드캐스트와 같이 불특정 다수에게 보내는 통신에는 적합하지 않음